# Snowfakery recipe — sample reservations only
# Run against an org that already has sample_data.yml loaded (Products, Assets, PricebookEntries)
# Creates guest Contacts, Opportunities, and OpportunityLineItems to demonstrate availability calculation
#
# Expected availability after load:
#   Women's 8-Bed:  5 of 8 reserved → "3 LEFT!"
#   Women's 4-Bed:  3 of 4 reserved → "1 LEFT!"
#   Men's 4-Bed:    1 of 4 reserved → "3 LEFT!"
#   Queen Ensuite:  1 of 3 reserved → "2 LEFT!"
#   Queen & Bunks:  2 of 4 reserved → "2 LEFT!"

- plugin: snowfakery.standard_plugins.Salesforce.SalesforceQuery

# ============================================================
# Guest Records
# ============================================================

- object: Account
  nickname: guest_account
  fields:
    Name: Sample Guests

- object: Contact
  nickname: guest_jane
  fields:
    AccountId:
      reference: guest_account
    FirstName: Jane
    LastName: Doe
    Email: jane.doe@example.com

- object: Contact
  nickname: guest_john
  fields:
    AccountId:
      reference: guest_account
    FirstName: John
    LastName: Smith
    Email: john.smith@example.com

# ============================================================
# Opportunities — Reservations overlapping today
# ============================================================

- object: Opportunity
  nickname: opp_jane
  fields:
    Name: Hostel Reservation - Jane Doe
    CloseDate: ${{today}}
    StageName: Prospecting
    Pricebook2Id:
      SalesforceQuery.find_record:
        from: Pricebook2
        where: IsStandard = true
    Check_In_Date__c: ${{today}}
    Check_Out_Date__c: ${{today + relativedelta(days=3)}}
    Number_of_Guests__c: 5

- object: Opportunity
  nickname: opp_john
  fields:
    Name: Hostel Reservation - John Smith
    CloseDate: ${{today}}
    StageName: Prospecting
    Pricebook2Id:
      SalesforceQuery.find_record:
        from: Pricebook2
        where: IsStandard = true
    Check_In_Date__c: ${{today}}
    Check_Out_Date__c: ${{today + relativedelta(days=2)}}
    Number_of_Guests__c: 5

- object: Opportunity
  nickname: opp_jane2
  fields:
    Name: Hostel Reservation - Jane Doe Family
    CloseDate: ${{today}}
    StageName: Prospecting
    Pricebook2Id:
      SalesforceQuery.find_record:
        from: Pricebook2
        where: IsStandard = true
    Check_In_Date__c: ${{today}}
    Check_Out_Date__c: ${{today + relativedelta(days=5)}}
    Number_of_Guests__c: 6

# ============================================================
# OpportunityLineItems — One per product type per reservation
# ============================================================

# --- Opp 1 (Jane): 3 Women's 8-Bed beds ---
- object: OpportunityLineItem
  fields:
    OpportunityId:
      reference: opp_jane
    Product2Id:
      SalesforceQuery.find_record:
        from: Product2
        where: Name LIKE 'Women%8-Bed Dorm'
    PricebookEntryId:
      SalesforceQuery.find_record:
        from: PricebookEntry
        where: Product2.Name LIKE 'Women%8-Bed Dorm' AND Pricebook2.IsStandard = true
    Quantity: 3
    UnitPrice: 39.00
    Number_of_Guests__c: 3

# --- Opp 1 (Jane): 2 Women's 4-Bed beds ---
- object: OpportunityLineItem
  fields:
    OpportunityId:
      reference: opp_jane
    Product2Id:
      SalesforceQuery.find_record:
        from: Product2
        where: Name LIKE 'Women%4-Bed Dorm'
    PricebookEntryId:
      SalesforceQuery.find_record:
        from: PricebookEntry
        where: Product2.Name LIKE 'Women%4-Bed Dorm' AND Pricebook2.IsStandard = true
    Quantity: 2
    UnitPrice: 49.00
    Number_of_Guests__c: 2

# --- Opp 2 (John): 2 Women's 8-Bed beds ---
- object: OpportunityLineItem
  fields:
    OpportunityId:
      reference: opp_john
    Product2Id:
      SalesforceQuery.find_record:
        from: Product2
        where: Name LIKE 'Women%8-Bed Dorm'
    PricebookEntryId:
      SalesforceQuery.find_record:
        from: PricebookEntry
        where: Product2.Name LIKE 'Women%8-Bed Dorm' AND Pricebook2.IsStandard = true
    Quantity: 2
    UnitPrice: 39.00
    Number_of_Guests__c: 2

# --- Opp 2 (John): 1 Women's 4-Bed bed ---
- object: OpportunityLineItem
  fields:
    OpportunityId:
      reference: opp_john
    Product2Id:
      SalesforceQuery.find_record:
        from: Product2
        where: Name LIKE 'Women%4-Bed Dorm'
    PricebookEntryId:
      SalesforceQuery.find_record:
        from: PricebookEntry
        where: Product2.Name LIKE 'Women%4-Bed Dorm' AND Pricebook2.IsStandard = true
    Quantity: 1
    UnitPrice: 49.00
    Number_of_Guests__c: 1

# --- Opp 2 (John): 1 Men's 4-Bed bed ---
- object: OpportunityLineItem
  fields:
    OpportunityId:
      reference: opp_john
    Product2Id:
      SalesforceQuery.find_record:
        from: Product2
        where: Name LIKE 'Men%4-Bed Dorm'
    PricebookEntryId:
      SalesforceQuery.find_record:
        from: PricebookEntry
        where: Product2.Name LIKE 'Men%4-Bed Dorm' AND Pricebook2.IsStandard = true
    Quantity: 1
    UnitPrice: 54.00
    Number_of_Guests__c: 1

# --- Opp 2 (John): 1 Private Queen Ensuite ---
- object: OpportunityLineItem
  fields:
    OpportunityId:
      reference: opp_john
    Product2Id:
      SalesforceQuery.find_record:
        from: Product2
        where: Name = 'Private Queen Ensuite'
    PricebookEntryId:
      SalesforceQuery.find_record:
        from: PricebookEntry
        where: Product2.Name = 'Private Queen Ensuite' AND Pricebook2.IsStandard = true
    Quantity: 1
    UnitPrice: 159.00
    Number_of_Guests__c: 2

# --- Opp 3 (Jane): 2 Private Queen & Bunks rooms ---
- object: OpportunityLineItem
  fields:
    OpportunityId:
      reference: opp_jane2
    Product2Id:
      SalesforceQuery.find_record:
        from: Product2
        where: Name = 'Private Queen & Bunks Ensuite'
    PricebookEntryId:
      SalesforceQuery.find_record:
        from: PricebookEntry
        where: Product2.Name = 'Private Queen & Bunks Ensuite' AND Pricebook2.IsStandard = true
    Quantity: 2
    UnitPrice: 189.00
    Number_of_Guests__c: 6
